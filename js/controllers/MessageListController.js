/**
 * Created by lconnected on 30/08/2017.
 */
app.controller('MessageListController', function ($scope, $controller, dataService, $routeParams) {
    var msgStub = [{"id":14,"from_id":-152271532,"to_id":-152271532,"date":1504204229,"marked_as_ads":0,"post_type":"post","text":"Самое приятное в рукоделии для дома и дачи своими руками – это то, что все необходимые инструменты и материалы можно найти под рукой. Нет нужды тратиться на готовые дорогостоящие изделия, чтобы внести в интерьер нотку домашнего уюта","signer_id":11089496,"can_edit":1,"created_by":11089496,"can_delete":1,"can_pin":1,"comments":{"count":0},"likes":{"count":0},"reposts":{"count":0}},{"id":10,"from_id":-152271532,"to_id":-152271532,"date":1504203635,"marked_as_ads":0,"post_type":"post","text":"","can_edit":1,"created_by":97384177,"can_delete":1,"can_pin":1,"attachment":{"type":"photo","photo":{"pid":456239023,"aid":-7,"owner_id":-152271532,"user_id":100,"src":"https://pp.userapi.com/c837639/v837639231/5658f/KF_a7JeRtiQ.jpg","src_big":"https://pp.userapi.com/c837639/v837639231/56590/hzvKQyjTd44.jpg","src_small":"https://pp.userapi.com/c837639/v837639231/5658e/g1Zv4fqiPjY.jpg","src_xbig":"https://pp.userapi.com/c837639/v837639231/56591/PadX-8Xq5OM.jpg","src_xxbig":"https://pp.userapi.com/c837639/v837639231/56592/O_GXGX7uNN8.jpg","src_xxxbig":"https://pp.userapi.com/c837639/v837639231/56593/pnJb4FHTMnM.jpg","width":1366,"height":2160,"text":"","created":1504203635,"post_id":10,"access_key":"bd4b5b3feb23e67f9f"}},"attachments":[{"type":"photo","photo":{"pid":456239023,"aid":-7,"owner_id":-152271532,"user_id":100,"src":"https://pp.userapi.com/c837639/v837639231/5658f/KF_a7JeRtiQ.jpg","src_big":"https://pp.userapi.com/c837639/v837639231/56590/hzvKQyjTd44.jpg","src_small":"https://pp.userapi.com/c837639/v837639231/5658e/g1Zv4fqiPjY.jpg","src_xbig":"https://pp.userapi.com/c837639/v837639231/56591/PadX-8Xq5OM.jpg","src_xxbig":"https://pp.userapi.com/c837639/v837639231/56592/O_GXGX7uNN8.jpg","src_xxxbig":"https://pp.userapi.com/c837639/v837639231/56593/pnJb4FHTMnM.jpg","width":1366,"height":2160,"text":"","created":1504203635,"post_id":10,"access_key":"bd4b5b3feb23e67f9f"}}],"comments":{"count":0},"likes":{"count":0},"reposts":{"count":0}},{"id":8,"from_id":-152271532,"to_id":-152271532,"date":1504203528,"marked_as_ads":0,"post_type":"post","text":"","can_edit":1,"created_by":97384177,"can_delete":1,"can_pin":1,"attachment":{"type":"photo","photo":{"pid":456239022,"aid":-7,"owner_id":-152271532,"user_id":100,"src":"https://pp.userapi.com/c837639/v837639231/56585/FP8vQb1LRSA.jpg","src_big":"https://pp.userapi.com/c837639/v837639231/56586/K6oU_R5ma3U.jpg","src_small":"https://pp.userapi.com/c837639/v837639231/56584/Xh5L0Ec1RNs.jpg","src_xbig":"https://pp.userapi.com/c837639/v837639231/56587/1y0FKcKCxV0.jpg","src_xxbig":"https://pp.userapi.com/c837639/v837639231/56588/QHprkbAiPP0.jpg","src_xxxbig":"https://pp.userapi.com/c837639/v837639231/56589/DXHfd6XpoOc.jpg","width":1536,"height":2048,"text":"","created":1504203528,"post_id":8,"access_key":"80da6a6e876261dc19"}},"attachments":[{"type":"photo","photo":{"pid":456239022,"aid":-7,"owner_id":-152271532,"user_id":100,"src":"https://pp.userapi.com/c837639/v837639231/56585/FP8vQb1LRSA.jpg","src_big":"https://pp.userapi.com/c837639/v837639231/56586/K6oU_R5ma3U.jpg","src_small":"https://pp.userapi.com/c837639/v837639231/56584/Xh5L0Ec1RNs.jpg","src_xbig":"https://pp.userapi.com/c837639/v837639231/56587/1y0FKcKCxV0.jpg","src_xxbig":"https://pp.userapi.com/c837639/v837639231/56588/QHprkbAiPP0.jpg","src_xxxbig":"https://pp.userapi.com/c837639/v837639231/56589/DXHfd6XpoOc.jpg","width":1536,"height":2048,"text":"","created":1504203528,"post_id":8,"access_key":"80da6a6e876261dc19"}}],"comments":{"count":0},"likes":{"count":0},"reposts":{"count":0}},{"id":6,"from_id":-152271532,"to_id":-152271532,"date":1504203330,"marked_as_ads":0,"post_type":"post","text":"Использовать следует нитки мулине, которые бывают разных производителей. Преимущество хлопчатобумажных ниток мулине в том, что:<br><br>мулине не линяют и не тускнеют со временем;<br>нитки мулине не кошлатятся и практически не запутываются;<br>нитки мулине наиболее распространены в вышивании, а потому дефицита в них не будет.<br>Виды ниток:<br><br>мулине – нить из хлопка. В ней скручены 6 волокон. Их можно разделять и соединять с другими цветами для достижения наилучшего результата. Особенно часто такие нитки применяют в вышивке крестом и гладью;<br>мягкий хлопок (толстое матовое волокно). Обычно их берут в работу для вышивания рисунка на тяжелых плотных тканях. Также ею очень удобно шнуровые стежки;<br>мерсеризованные нити – это крученные нити из хлопка. Они имеют характерный блеск. Выпускаются в мотках или клубках, существуют нити разной толщины;<br>металлизированные нити – напоминают тоненькую блестящую проволочку. Ею выполняют вышивки золотом, работы крестиком, также их часто сочетают с другими хлопковыми или шерстяными нитками;<br>шелк, вискоза. Эти нити используют для вышивания с сильным блеском, рисунок получается очень мягким;<br>тонкая шерсть – нить в 2 волокна. Ее можно вышивать отдельно, а можно и сочетать с другими нитками;<br>персидская пряжа – мягкая пряжа из шерсти, ее не разделяют на отдельные волокна. Такой пряжей выполняют вышивку гобеленов, гладью и прочих техник;","can_edit":1,"created_by":97384177,"can_delete":1,"can_pin":1,"comments":{"count":0},"likes":{"count":0},"reposts":{"count":0}},{"id":5,"from_id":-152271532,"to_id":-152271532,"date":1504203279,"marked_as_ads":0,"post_type":"post","text":"Иглы<br><br>Разновидности игл для вышивкиДля разных видов ткани лучше иметь набор игл из 6-7 штук, которые должны разниться по длине и толщине. Те, что тоньше, подходят для работ на тонких полотнах, таких как батист, крепдешин, маркизет, на хлопчатобумажных тканях, льне, канве. Самые толстые иглы предназначены для грубой ткани, например, шерсти.<br><br>Единственное, что должно объединять эти иглы, — это закругленный тупой конец, а также большое ушко, которое не будет перетирать нить. Их называют гобеленовыми, особенно такие иглы удобны при вышивке крестиком. Их тупой конец бережно проходит между волокнами материала, не повреждая их. Поскольку вышивать часто приходится нитками в несколько волокон или сложений, то ушко гобеленовой иглы создает все условия для быстрого и удобного введения нити.<br><br>Наперсток<br><br>Подбираем наперстки для вышивки Он служит для более легкого проталкивания иглы сквозь ткань или через несколько слоев и в других моментах, когда нужно прилагать усилия при прокалывании ткани. Лучше, если наперсток будет изготовлен из нержавеющей стали. Очень важно померить его на средний палец правой руки. Он не должен свободно болтаться и в то же время не пережимать фалангу. Между наперстком без донышка и с ним, лучше выбрать последний — он удобнее.<br><br>Пяльцы<br><br>Пяльцы служат для удержания материала натянутым и предотвращают стягивание ткани под рисунком. Их изготавливают из дерева, металла или пластмассы. Лучше, чтоб пяльцы были деревянные, так как пластиковые часто плохо держат ткань и постоянно соскальзывают, следовательно, может пострадать качество готового изделия. Форма тоже может быть разной: круглой, квадратной, прямоугольной. Также следует выбирать пяльцы с идеально гладкой ровной поверхностью, во избежание повреждения ткани.<br><br>Деревянные пяльца с винтом Еще один совет: гораздо удобней пяльцы покупать с винтом, который будет регулировать натяжение материала, в них можно вставлять полотно любой толщины.<br><br>Материал в пяльцы нужно заправлять аккуратно и внимательно, чтоб она не перекашивалась, поскольку в дальнейшем рисунок получится деформированным.<br><br>Но если вы будете вышивать большую картину, то перетягивание канвы на не пяльцах вас может утомить, тогда более разумно будет использование станка для вышивания.","can_edit":1,"created_by":97384177,"can_delete":1,"can_pin":1,"attachment":{"type":"photo","photo":{"pid":456239021,"aid":-7,"owner_id":-152271532,"user_id":100,"src":"https://pp.userapi.com/c837639/v837639231/5657d/LwRgneZ-I94.jpg","src_big":"https://pp.userapi.com/c837639/v837639231/5657e/anvIcysBuxI.jpg","src_small":"https://pp.userapi.com/c837639/v837639231/5657c/V--BgI3yvVE.jpg","src_xbig":"https://pp.userapi.com/c837639/v837639231/5657f/HctZOuj9qpI.jpg","width":640,"height":426,"text":"","created":1504203279,"post_id":5,"access_key":"8098d83c36d9f8014d"}},"attachments":[{"type":"photo","photo":{"pid":456239021,"aid":-7,"owner_id":-152271532,"user_id":100,"src":"https://pp.userapi.com/c837639/v837639231/5657d/LwRgneZ-I94.jpg","src_big":"https://pp.userapi.com/c837639/v837639231/5657e/anvIcysBuxI.jpg","src_small":"https://pp.userapi.com/c837639/v837639231/5657c/V--BgI3yvVE.jpg","src_xbig":"https://pp.userapi.com/c837639/v837639231/5657f/HctZOuj9qpI.jpg","width":640,"height":426,"text":"","created":1504203279,"post_id":5,"access_key":"8098d83c36d9f8014d"}}],"comments":{"count":0},"likes":{"count":0},"reposts":{"count":0}},{"id":4,"from_id":-152271532,"to_id":-152271532,"date":1504203186,"marked_as_ads":0,"post_type":"post","text":"Канва<br><br>Канва — это ткань, которая используется при вышивании крестом. Для начинающих отлично подойдет канва с уже нанесенным на нее рисунком. Вышивать поверх готовой картинки гораздо легче и быстрее. К тому же, как правило, канва с нанесенным рисунком продается уже с набором нужных ниток необходимого количества. Учиться вышивать на такой канве — одно удовольствие.<br><br>Цветовая палитра канвы<br>Канва<br>Более смелые могут учиться вышивать на «чистой ткани». В зависимости от размеров крестов, канва имеет свой коэффициент. Сложность работы от размеров крестиков не зависит, но именно по этому признаку Вам следует выбирать, во сколько ниток вышивать. Есть еще одна разновидность ткани для вышивки, которая называется равномерной, в ней крестики мало заметны.<br><br>Собственно, вышивать можно абсолютно на любой ткани. Однако некоторые техники удобнее выполнять по материалу, у которого есть четко очерченное переплетением.<br><br>Часто вышивальщицы берут накладную канву. Ее пришивают сверху на лицевую сторону любой ткани, после того, как изделие будет выполнено – ее нити аккуратно вынимают.<br><br>цветовая палитра канвы Aida<br>Канвы Aida<br>Aida – самый известный вид канвы, она сделана из стопроцентного хлопка. Крестики на ней очень четко видны, что облегчает задачу. Разнообразие цветов позволяет сделать работу еще интересней. Аиду обычно используют для вышивки крестиком, бисером, гобеленом.<br><br>Лен – тканное полотно в которых содержится лен. Для такого материала характерно то, что его нити имею разную толщину. Вышивку выполнять на ней нужно как минимум через две нити. Также при работе со льном необходимы пяльцы.","can_edit":1,"created_by":97384177,"can_delete":1,"can_pin":1,"attachment":{"type":"photo","photo":{"pid":456239020,"aid":-7,"owner_id":-152271532,"user_id":100,"src":"https://pp.userapi.com/c837639/v837639231/56573/wuEIqCM9pJ8.jpg","src_big":"https://pp.userapi.com/c837639/v837639231/56574/JUwOhFAt4LU.jpg","src_small":"https://pp.userapi.com/c837639/v837639231/56572/C2DlNN5Nd04.jpg","src_xbig":"https://pp.userapi.com/c837639/v837639231/56575/WzUGr4uMrZc.jpg","src_xxbig":"https://pp.userapi.com/c837639/v837639231/56576/nDnHaCa7Mxw.jpg","src_xxxbig":"https://pp.userapi.com/c837639/v837639231/56577/uDVccW6jXxg.jpg","width":2560,"height":1912,"text":"","created":1504203187,"post_id":4,"access_key":"e1de70814138420174"}},"attachments":[{"type":"photo","photo":{"pid":456239020,"aid":-7,"owner_id":-152271532,"user_id":100,"src":"https://pp.userapi.com/c837639/v837639231/56573/wuEIqCM9pJ8.jpg","src_big":"https://pp.userapi.com/c837639/v837639231/56574/JUwOhFAt4LU.jpg","src_small":"https://pp.userapi.com/c837639/v837639231/56572/C2DlNN5Nd04.jpg","src_xbig":"https://pp.userapi.com/c837639/v837639231/56575/WzUGr4uMrZc.jpg","src_xxbig":"https://pp.userapi.com/c837639/v837639231/56576/nDnHaCa7Mxw.jpg","src_xxxbig":"https://pp.userapi.com/c837639/v837639231/56577/uDVccW6jXxg.jpg","width":2560,"height":1912,"text":"","created":1504203187,"post_id":4,"access_key":"e1de70814138420174"}}],"comments":{"count":0},"likes":{"count":0},"reposts":{"count":0}},{"id":3,"from_id":-152271532,"to_id":-152271532,"date":1504203058,"marked_as_ads":0,"post_type":"post","text":"Самый любимый и распространенный вид хобби, конечно, вышивка крестиком. Так или иначе она знакома многим рукодельницам, и зачастую именно с нее начинается увлечение рукоделием.<br>Считается, что вышивание крестом благотворно влияет на здоровье: она помогает снять нервное напряжение и избавиться от шума в ушах, развивает мелкую моторику.","can_edit":1,"created_by":97384177,"can_delete":1,"can_pin":1,"attachment":{"type":"photo","photo":{"pid":456239019,"aid":-7,"owner_id":-152271532,"user_id":100,"src":"https://pp.userapi.com/c837639/v837639231/56569/rdJGG00YEyY.jpg","src_big":"https://pp.userapi.com/c837639/v837639231/5656a/Fp6aW0GAp9o.jpg","src_small":"https://pp.userapi.com/c837639/v837639231/56568/lIZd9OOb67k.jpg","src_xbig":"https://pp.userapi.com/c837639/v837639231/5656b/ZziiUSZ356Q.jpg","src_xxbig":"https://pp.userapi.com/c837639/v837639231/5656c/8blGoNUkyxQ.jpg","src_xxxbig":"https://pp.userapi.com/c837639/v837639231/5656d/JR6VtD18A28.jpg","width":1613,"height":2160,"text":"","created":1504203058,"post_id":3,"access_key":"affa098432a5377a12"}},"attachments":[{"type":"photo","photo":{"pid":456239019,"aid":-7,"owner_id":-152271532,"user_id":100,"src":"https://pp.userapi.com/c837639/v837639231/56569/rdJGG00YEyY.jpg","src_big":"https://pp.userapi.com/c837639/v837639231/5656a/Fp6aW0GAp9o.jpg","src_small":"https://pp.userapi.com/c837639/v837639231/56568/lIZd9OOb67k.jpg","src_xbig":"https://pp.userapi.com/c837639/v837639231/5656b/ZziiUSZ356Q.jpg","src_xxbig":"https://pp.userapi.com/c837639/v837639231/5656c/8blGoNUkyxQ.jpg","src_xxxbig":"https://pp.userapi.com/c837639/v837639231/5656d/JR6VtD18A28.jpg","width":1613,"height":2160,"text":"","created":1504203058,"post_id":3,"access_key":"affa098432a5377a12"}}],"comments":{"count":0},"likes":{"count":0},"reposts":{"count":0}},{"id":1,"from_id":-152271532,"to_id":-152271532,"date":1503406694,"marked_as_ads":0,"post_type":"post","text":"Самое приятное в рукоделии для дома и дачи своими руками – это то, что все необходимые инструменты и материалы можно найти под рукой. Нет нужды тратиться на готовые дорогостоящие изделия, чтобы внести в интерьер нотку домашнего уюта, тепла и душевности, если можно сделать их самостоятельно!🖐🏻","signer_id":97384177,"can_delete":1,"can_pin":1,"attachment":{"type":"photo","photo":{"pid":456239017,"aid":-7,"owner_id":-152271532,"user_id":100,"src":"https://pp.userapi.com/c635103/v635103009/3b880/KK3Qlyj0UsU.jpg","src_big":"https://pp.userapi.com/c635103/v635103009/3b881/AC2NAAIslZc.jpg","src_small":"https://pp.userapi.com/c635103/v635103009/3b87f/H1AXt5NRzbY.jpg","src_xbig":"https://pp.userapi.com/c635103/v635103009/3b882/1qg3YPeeS60.jpg","width":760,"height":516,"text":"","created":1503406694,"post_id":1,"access_key":"26b202b235bec283dd"}},"attachments":[{"type":"photo","photo":{"pid":456239017,"aid":-7,"owner_id":-152271532,"user_id":100,"src":"https://pp.userapi.com/c635103/v635103009/3b880/KK3Qlyj0UsU.jpg","src_big":"https://pp.userapi.com/c635103/v635103009/3b881/AC2NAAIslZc.jpg","src_small":"https://pp.userapi.com/c635103/v635103009/3b87f/H1AXt5NRzbY.jpg","src_xbig":"https://pp.userapi.com/c635103/v635103009/3b882/1qg3YPeeS60.jpg","width":760,"height":516,"text":"","created":1503406694,"post_id":1,"access_key":"26b202b235bec283dd"}}],"comments":{"count":0},"likes":{"count":0},"reposts":{"count":0}}];
    msgStub.forEach((msg) => {
        msg.date *= 1000;
    });
    addMessages(msgStub);
    // var messagesList = groupService.getMessagesList($routeParams.groupId, 0, 10);
    // if (messagesList !== null) {
    //     messagesList.then(function (data) {
    //         var filteredPosts = data.wall.filter(function (wallPost) {
    //             return wallPost.id !== undefined;
    //         });
    //         addMessages(filteredPosts);
    //     });
    // }
    function addMessages(messages) {
        $scope.messages = messages;
    }

    $scope.formatMessage = function (message) {
        let formattedMessage = dataService.escapeEmoji(message);
        if (!formattedMessage.length) {
            return "<Текст отсутствует>";
        } else {
            return formattedMessage;
        }
    }

    $scope.repostMessage = function (message) {
        let promise = dataService.postMessage($routeParams.groupId, message.text, message.attachments);
        promise.then(function (data) {
            alert('Сообщение переопубликовано');
        }).catch(function (err) {
            alert('Произошла ошибка');
        });
    };
});